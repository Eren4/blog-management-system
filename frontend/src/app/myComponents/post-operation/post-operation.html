<table>
    <tr>
        <th>Id</th>
        <th>Başlık</th>
        <th>İçerik</th>
        <th>Alıntı</th>
        <th>Yayımlanma durumu</th>
    </tr>

    @for(post of posts(); track post.id) {
        <tr>
            <td>{{ post.id }}</td>
            <td> {{ post.title }} </td>
            <td> {{ post.content }} </td>
            <td> {{ post.excerpt }} </td>
            <td>
                @if(post.publishState !== null) {
                    {{ PublishState[post.publishState] }}
                }
            </td>
            <td>
                <button (click)="startUpdate(post)">Güncelle</button>
                <button (click)="onDelete(post.id)">Sil</button>
            </td>
        </tr>
    }
</table>

<hr>

<form [formGroup]="createForm" (ngSubmit)="onCreate()">
    <h3>Gönderi Ekle</h3>
    <label>
        Başlık
        <input type="text" formControlName="title" />
    </label>
    @if(getErrorMessageByName(createForm, 'title'); as msg) {
        <div class="error">
            {{ msg }}
        </div>
    }

    <label>
        İçerik
        <input type="text" formControlName="content" />
    </label>
    @if(getErrorMessageByName(createForm, 'content'); as msg) {
        <div class="error">
            {{ msg }}
        </div>
    }

    <label>
        Alıntı
        <input type="text" formControlName="excerpt" />
    </label>
    @if(getErrorMessageByName(createForm, 'excerpt'); as msg) {
        <div class="error">
            {{ msg }}
        </div>
    }

    <label>
        Yayınlanma durumu
        <select formControlName="publishState">
            <option [ngValue]="null" disabled>Seçiniz</option>
            @for(state of publishStates(); track state;) {
                <option [ngValue]="state"> {{ PublishState[state] }} </option>
            }
        </select>
    </label>
    @if(getErrorMessageByName(createForm, 'publishState'); as msg) {
        <div class="error">
            {{ msg }}
        </div>
    }

    <button type="submit" [disabled]="createForm.invalid">Ekle</button>
</form>

<hr>

@if(selectedPost() !== null) {
    <form [formGroup]="updateForm" (ngSubmit)="onUpdate()">
        <h3>Gönderi güncelle</h3>

        <input type="hidden" formControlName="id" />

        <label>
            Başlık
            <input type="text" formControlName="title" />
        </label>
        @if(getErrorMessageByName(createForm, 'title'); as msg) {
            <div class="error">
                {{ msg }}
            </div>
        }

        <label>
            İçerik
            <input type="text" formControlName="content" />
        </label>
        @if(getErrorMessageByName(createForm, 'content'); as msg) {
            <div class="error">
                {{ msg }}
            </div>
        }

        <label>
            Alıntı
            <input type="text" formControlName="excerpt" />
        </label>
        @if(getErrorMessageByName(createForm, 'excerpt'); as msg) {
            <div class="error">
                {{ msg }}
            </div>
        }

        <label>
            Yayınlanma durumu
            <select formControlName="publishState">
                <option [ngValue]="null" disabled>Seçiniz</option>
                @for(state of publishStates(); track state;) {
                    <option [ngValue]="state"> {{ PublishState[state] }} </option>
                }
            </select>
        </label>
        @if(getErrorMessageByName(createForm, 'publishState'); as msg) {
            <div class="error">
                {{ msg }}
            </div>
        }

        <button type="submit" [disabled]="updateForm.invalid">Güncelle</button>

        <button type="button" (click)="cancelUpdate()">İptal</button>
    </form>
}